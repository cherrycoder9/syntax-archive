# 예외 처리

## finally 블록의 활용

### finally 블록의 특성

finally 블록은 try-catch 구문의 마지막에 위치하며, 예외 발생 여부와 관계없이 항상 실행되는 코드 영역임. 주요 특징은 다음과 같음:

- 예외가 발생하거나 발생하지 않아도 반드시 실행됨
- 주로 자원 해제, 연결 종료 등 cleanup 작업에 사용됨
- try나 catch 블록에서 return문이 실행되더라도 finally 블록은 실행됨

### finally 블록의 활용 예시

- 파일 입출력 작업에서의 자원 해제:

```java
FileInputStream fis = null;
try {
    fis = new FileInputStream("important_data.txt");
    // 파일 읽기 작업
} catch (FileNotFoundException e) {
    System.out.println("파일을 찾을 수 없음: " + e.getMessage());
} finally {
    if (fis != null) {
        try {
            fis.close();
        } catch (IOException e) {
            System.out.println("파일 닫기 실패: " + e.getMessage());
        }
    }
}
```

- 데이터베이스 연결 종료:

```java
Connection conn = null;
Statement stmt = null;
try {
    conn = DriverManager.getConnection("jdbc:mysql://localhost/mydb", "user", "password");
    stmt = conn.createStatement();
    // 데이터베이스 작업
} catch (SQLException e) {
    System.out.println("데이터베이스 오류: " + e.getMessage());
} finally {
    try {
        if (stmt != null) stmt.close();
        if (conn != null) conn.close();
    } catch (SQLException e) {
        System.out.println("연결 종료 중 오류: " + e.getMessage());
    }
}
```

### finally 블록 사용 시 주의사항

- finally 블록 내 예외 처리:

finally 블록에서 예외가 발생할 수 있음을 항상 염두에 두어야 함. 예를 들어, 자원을 닫을 때 IOException이 발생할 수 있음.

```java
try {
    // 주요 로직
} catch (Exception e) {
    System.out.println("예외 발생: " + e.getMessage());
} finally {
    try {
        // 자원 해제 로직
    } catch (IOException e) {
        System.out.println("자원 해제 중 오류: " + e.getMessage());
    }
}
```

- return 문과 finally 블록:

finally 블록은 try 또는 catch 블록에서 return 문이 실행된 후에도 실행됨. 그러나 finally 블록에서 return 문을 사용하면 이전 블록의 return 값을 덮어쓰게 되므로 주의해야 함.

```java
public int riskyOperation() {
    try {
        // 위험한 연산
        return 1;  // 이 값은 무시될 수 있음
    } catch (Exception e) {
        return -1;  // 이 값도 무시될 수 있음
    } finally {
        return 0;  // 이 값이 항상 반환됨
    }
}
```

- 불필요한 finally 블록 사용 피하기:

Java 7부터 도입된 try-with-resources 구문을 사용하면 많은 경우 finally 블록 없이도 자원을 안전하게 해제할 수 있음.

```java
try (FileInputStream fis = new FileInputStream("data.txt");
    BufferedReader br = new BufferedReader(new InputStreamReader(fis))) {
    String line;
    while ((line = br.readLine()) != null) {
        System.out.println(line);
    }
} catch (IOException e) {
    System.out.println("파일 읽기 오류: " + e.getMessage());
}
```

이 방식은 코드를 더 간결하게 만들고 자원 누수 가능성을 줄여줌.

### finally 블록의 실행 순서

1. try 블록 정상 실행 시: try → finally
2. try 블록에서 예외 발생 시: try(예외 발생 지점까지) → catch → finally
3. try 블록에서 return 실행 시: try → finally → return

finally 블록은 예외 처리의 중요한 부분으로, 자원 관리와 코드의 안정성을 높이는 데 큰 역할을 함. 그러나 불필요하게 복잡한 로직을 finally 블록에 넣지 않도록 주의해야 하며, 가능한 경우 try-with-resources 구문을 활용하는 것이 좋음.
