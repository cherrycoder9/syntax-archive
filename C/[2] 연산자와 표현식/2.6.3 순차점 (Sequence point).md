# 연산자와 표현식

## 연산자 우선순위와 결합성

### 순차점 (Sequence point)

순차점은 C 언어에서 표현식 평가 순서와 부작용 발생 시점을 정의하는 중요한 개념임. 모든 순차점에서 이전에 평가된 표현식의 모든 부작용이 완료되고, 다음 표현식 평가 전에 모든 임시 값이 폐기됨.

주요 순차점:

1. 함수 호출의 인자 평가 완료 시점
2. &&, ||, ?:, 콤마 연산자의 첫 번째 피연산자 평가 후
3. 전체 표현식의 평가 완료 시점
4. 초기화 리스트의 각 요소 사이

순차점의 이해는 복잡한 표현식에서 예기치 않은 동작을 방지하는 데 중요함. 예제를 통해 살펴보자:

```c
#include <stdio.h>

int func(int *x) {
    (*x)++;
    return *x;
}

int main() {
    int i = 5;
    
    // 위험한 코드: 정의되지 않은 동작
    int result = i++ + i++;
    printf("위험한 결과: %d (i = %d)\n", result, i);
    
    // 순차점을 이용한 안전한 코드
    i = 5;
    result = (i++, i++);
    printf("안전한 결과: %d (i = %d)\n", result, i);
    
    // 함수 호출과 순차점
    i = 5;
    result = func(&i) + func(&i);
    printf("함수 호출 결과: %d (i = %d)\n", result, i);
    
    return 0;
}
```

이 예제에서:

1. `i++ + i++`는 정의되지 않은 동작을 유발함. 컴파일러에 따라 결과가 다를 수 있음.
2. 콤마 연산자를 사용한 `(i++, i++)`는 안전함. 왼쪽에서 오른쪽으로 순차적으로 평가됨.
3. 함수 호출의 경우, 각 `func(&i)` 호출 사이에 순차점이 있어 결과가 예측 가능함.

순차점 관련 주의사항:

1. 부작용이 있는 표현식(++, --, 대입 등)을 같은 문장에서 여러 번 사용하지 않는 게 좋음.
2. 복잡한 표현식은 여러 문장으로 나누는 게 안전함.
3. 컴파일러 최적화로 인해 예상치 못한 결과가 나올 수 있으니 주의해야 함.

```c
int x = 1;
printf("%d %d\n", ++x, x++);  // 출력이 "3 1"일 수도, "2 1"일 수도 있음
```

이런 코드는 피해야 함. 대신 아래처럼 명확하게 작성:

```c
int x = 1;
++x;
printf("%d ", x);
printf("%d\n", x++);
```

순차점을 이해하고 적절히 활용하면 예측 가능하고 안정적인 코드를 작성할 수 있음. 복잡한 표현식을 다룰 때는 항상 순차점을 고려해 코드의 동작을 명확히 하는 게 중요함.
